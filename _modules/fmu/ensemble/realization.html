<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fmu.ensemble.realization &mdash; fmu-ensemble 1.6.9.dev9+g7d01470 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=e1b421ee"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            fmu-ensemble
              <img src="../../../_static/equinor-logo2.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.6.9.dev9+g7d01470
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Introduction to <em>fmu.ensemble</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts.html">Concepts in fmu-ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advancedusage.html">Advanced usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API for fmu.ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">fmu-ensemble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">fmu.ensemble.realization</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for fmu.ensemble.realization</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module for the ScratchRealization class</span>

<span class="sd">A realization is a set of results from one subsurface model</span>
<span class="sd">realization. A realization can be either defined from</span>
<span class="sd">its output files from the FMU run on the file system,</span>
<span class="sd">it can be computed from other realizations, or it can be</span>
<span class="sd">an archived realization.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span>

<span class="kn">import</span> <span class="nn">dateutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">resdata.grid</span> <span class="kn">import</span> <span class="n">Grid</span>
<span class="kn">from</span> <span class="nn">resdata.rd_util</span> <span class="kn">import</span> <span class="n">FileMode</span>
<span class="kn">from</span> <span class="nn">resdata.resfile</span> <span class="kn">import</span> <span class="n">ResdataFile</span>
<span class="kn">from</span> <span class="nn">resdata.summary</span> <span class="kn">import</span> <span class="n">Summary</span>

<span class="kn">from</span> <span class="nn">.realizationcombination</span> <span class="kn">import</span> <span class="n">RealizationCombination</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">parse_number</span><span class="p">,</span> <span class="n">shortcut2path</span>
<span class="kn">from</span> <span class="nn">.util.dates</span> <span class="kn">import</span> <span class="n">unionize_smry_dates</span>
<span class="kn">from</span> <span class="nn">.util.rates</span> <span class="kn">import</span> <span class="n">compute_volumetric_rates</span>
<span class="kn">from</span> <span class="nn">.virtualrealization</span> <span class="kn">import</span> <span class="n">VirtualRealization</span>

<span class="n">HAVE_ECL2DF</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ecl2df</span>

    <span class="n">HAVE_ECL2DF</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAVE_ECL2DF</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">HAVE_RES2DF</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">res2df</span>

    <span class="n">HAVE_RES2DF</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAVE_RES2DF</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ScratchRealization"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization">[docs]</a><span class="k">class</span> <span class="nc">ScratchRealization</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A representation of results still present on disk</span>

<span class="sd">    ScratchRealizations point to the filesystem for their</span>
<span class="sd">    contents.</span>

<span class="sd">    A realization must at least contain a STATUS file.</span>
<span class="sd">    Additionally, jobs.json and parameters.txt will be attempted</span>
<span class="sd">    loaded by default.</span>

<span class="sd">    The realization is defined by the pointers to the filesystem.</span>
<span class="sd">    When asked for, this object will return data from the</span>
<span class="sd">    filesystem (or from cache if already computed).</span>

<span class="sd">    The files dataframe is the central filesystem pointer</span>
<span class="sd">    repository for the object. It will at least contain</span>
<span class="sd">    the columns</span>
<span class="sd">    * FULLPATH absolute path to a file</span>
<span class="sd">    * FILETYPE filename extension (after last dot)</span>
<span class="sd">    * LOCALPATH relative filename inside realization diretory</span>
<span class="sd">    * BASENAME filename only. No path. Includes extension</span>

<span class="sd">    This dataframe is available as a read-only property from the object</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): absolute or relative path to a directory</span>
<span class="sd">            containing a realizations files.</span>
<span class="sd">        realidxregexp (re/str): a compiled regular expression which</span>
<span class="sd">            is used to determine the realization index (integer)</span>
<span class="sd">            from the path. First match is the index.</span>
<span class="sd">            Default: realization-(\d+)</span>
<span class="sd">            Only needs to match path components.</span>
<span class="sd">            If a string is supplied, it will be attempted</span>
<span class="sd">            compiled into a regular expression.</span>
<span class="sd">        index (int): the realization index to be used, will</span>
<span class="sd">            override anything else.</span>
<span class="sd">        autodiscovery (boolean): whether the realization should try to</span>
<span class="sd">            auto-discover certain data (UNSMRY files in standard location)</span>
<span class="sd">        batch (dict): List of functions (load_*) that</span>
<span class="sd">            should be run at time of initialization. Each element is a</span>
<span class="sd">            length 1 dictionary with the function name to run as the key</span>
<span class="sd">            and each keys value should be the function arguments as a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">realidxregexp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">autodiscovery</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autodiscovery</span> <span class="o">=</span> <span class="n">autodiscovery</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">realidxregexp</span><span class="p">:</span>
            <span class="n">realidxregexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;realization-(\d+)&quot;</span><span class="p">)</span>
        <span class="c1"># Try to compile the regexp on behalf of the user.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">realidxregexp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">realidxregexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">realidxregexp</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">realidxregexp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Supplied realidxregexp not valid&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">,</span> <span class="s2">&quot;FILETYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">,</span> <span class="s2">&quot;BASENAME&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Placeholder for caching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum_include_restart</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Flag for cached object</span>

        <span class="c1"># The datastore for internalized data. Dictionary</span>
        <span class="c1"># indexed by filenames (local to the realization).</span>
        <span class="c1"># values in the dictionary can be either dicts or dataframes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eclinit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eclunrst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eclgrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ecldata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actnum</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">abspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path_comp</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span>
                <span class="n">realidxmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">realidxregexp</span><span class="p">,</span> <span class="n">path_comp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">realidxmatch</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">realidxmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;Could not determine realization &quot;</span>
                        <span class="s2">&quot;index for </span><span class="si">%s</span><span class="s2">, &quot;</span>
                        <span class="s2">&quot;this cannot be inserted in an Ensemble&quot;</span>
                    <span class="p">),</span>
                    <span class="n">abspath</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Maybe you need to use index=&lt;someinteger&gt;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Now look for some common files, but don&#39;t require any</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">)):</span>
            <span class="n">filerow</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">:</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FILETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FULLPATH&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">),</span>
                <span class="s2">&quot;BASENAME&quot;</span><span class="p">:</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_status</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No STATUS file, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">abspath</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;jobs.json&quot;</span><span class="p">)):</span>
            <span class="n">filerow</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">:</span> <span class="s2">&quot;jobs.json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FILETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FULLPATH&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;jobs.json&quot;</span><span class="p">),</span>
                <span class="s2">&quot;BASENAME&quot;</span><span class="p">:</span> <span class="s2">&quot;jobs.json&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_scalar</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abspath</span><span class="p">,</span> <span class="s2">&quot;parameters.txt&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_txt</span><span class="p">(</span><span class="s2">&quot;parameters.txt&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialized </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">abspath</span><span class="p">)</span>

<div class="viewcode-block" id="ScratchRealization.process_batch"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.process_batch">[docs]</a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a list of functions to run/apply</span>

<span class="sd">        This is equivalent to calling each function individually</span>
<span class="sd">        but this enables more efficient concurrency. It is meant</span>
<span class="sd">        to be used for functions that modifies the realization</span>
<span class="sd">        object, not for functions that returns a dataframe already.</span>

<span class="sd">        Args:</span>
<span class="sd">            batch (list): Each list element is a dictionary with one key,</span>
<span class="sd">                being a function names, value pr key is a dict with keyword</span>
<span class="sd">                arguments to be supplied to each function.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ScratchRealization: This realization object (self), for it</span>
<span class="sd">                to be picked up by ProcessPoolExecutor and pickling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">allowed_functions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;apply&quot;</span><span class="p">,</span>
            <span class="s2">&quot;find_files&quot;</span><span class="p">,</span>
            <span class="s2">&quot;load_smry&quot;</span><span class="p">,</span>
            <span class="s2">&quot;load_txt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;load_file&quot;</span><span class="p">,</span>
            <span class="s2">&quot;load_csv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;load_status&quot;</span><span class="p">,</span>
            <span class="s2">&quot;load_scalar&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">fn_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Batch processing (#</span><span class="si">%d</span><span class="s2">): </span><span class="si">%s</span><span class="s2"> with args </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="n">fn_name</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="n">fn_name</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fn_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_functions</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;process_batch skips illegal function: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">)(</span><span class="o">**</span><span class="n">cmd</span><span class="p">[</span><span class="n">fn_name</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ScratchRealization.runpath"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.runpath">[docs]</a>    <span class="k">def</span> <span class="nf">runpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the runpath (&quot;root&quot;) of the realization</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: the filesystem path which at least existed</span>
<span class="sd">                at time of object initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span></div>

<div class="viewcode-block" id="ScratchRealization.to_virtual"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.to_virtual">[docs]</a>    <span class="k">def</span> <span class="nf">to_virtual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the current ScratchRealization object</span>
<span class="sd">        to a VirtualRealization</span>

<span class="sd">        Args:</span>
<span class="sd">            description (str): used as label</span>
<span class="sd">            deepcopy (boolean): Set to true if you want to continue</span>
<span class="sd">               to manipulate the ScratchRealization object</span>
<span class="sd">               afterwards without affecting the virtual realization.</span>
<span class="sd">               Defaults to True. False will give faster execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span>
        <span class="k">if</span> <span class="n">deepcopy</span><span class="p">:</span>
            <span class="n">vreal</span> <span class="o">=</span> <span class="n">VirtualRealization</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vreal</span> <span class="o">=</span> <span class="n">VirtualRealization</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Conserve metadata for smry vectors. Build metadata dict for all</span>
        <span class="c1"># loaded summary vectors.</span>
        <span class="n">smrycolumns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;unsmry&quot;</span> <span class="ow">in</span> <span class="n">key</span>
        <span class="p">]</span>
        <span class="n">smrycolumns</span> <span class="o">=</span> <span class="p">{</span><span class="n">smrykey</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">smrycolumns</span> <span class="k">for</span> <span class="n">smrykey</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">}</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smry_meta</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">smrycolumns</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
            <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;SMRYCOLUMN&quot;</span>
            <span class="n">vreal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__smry_metadata&quot;</span><span class="p">,</span> <span class="n">meta_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">vreal</span></div>

<div class="viewcode-block" id="ScratchRealization.load_file"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.load_file">[docs]</a>    <span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">,</span> <span class="n">fformat</span><span class="p">,</span> <span class="n">convert_numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_reread</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse and internalize files from disk.</span>

<span class="sd">        Several file formats are supported:</span>
<span class="sd">        - txt (one key-value pair pr. line)</span>
<span class="sd">        - csv</span>
<span class="sd">        - scalar (one number or one string in the first line)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fformat</span> <span class="o">==</span> <span class="s2">&quot;txt&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_txt</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span> <span class="n">convert_numeric</span><span class="p">,</span> <span class="n">force_reread</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fformat</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_csv</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span> <span class="n">convert_numeric</span><span class="p">,</span> <span class="n">force_reread</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fformat</span> <span class="o">==</span> <span class="s2">&quot;scalar&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_scalar</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span> <span class="n">convert_numeric</span><span class="p">,</span> <span class="n">force_reread</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported file format </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fformat</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.load_scalar"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.load_scalar">[docs]</a>    <span class="k">def</span> <span class="nf">load_scalar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">localpath</span><span class="p">,</span>
        <span class="n">convert_numeric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">force_reread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">skip_blank_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single value from a file.</span>

<span class="sd">        The value can be a string or a number.</span>

<span class="sd">        Empty files are treated as existing, with an empty string as</span>
<span class="sd">        the value, different from non-existing files.</span>

<span class="sd">        pandas.read_table() is used to parse the contents, the args</span>
<span class="sd">        &#39;comment&#39;, &#39;skip_blank_lines&#39;, and &#39;skipinitialspace&#39; is passed on</span>
<span class="sd">        to that function.</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath: path to the file, local to the realization</span>
<span class="sd">            convert_numeric: If True, non-numerical content will be thrown away</span>
<span class="sd">            force_reread: Reread the data from disk.</span>
<span class="sd">        Returns:</span>
<span class="sd">            str/number: the value read from the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="n">localpath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;File not found: &quot;</span> <span class="o">+</span> <span class="n">fullpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reread</span><span class="p">:</span>
            <span class="c1"># Return cached version</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">filerow</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">:</span> <span class="n">localpath</span><span class="p">,</span>
                <span class="s2">&quot;FILETYPE&quot;</span><span class="p">:</span> <span class="n">localpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;FULLPATH&quot;</span><span class="p">:</span> <span class="n">fullpath</span><span class="p">,</span>
                <span class="s2">&quot;BASENAME&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">localpath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">fullpath</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;DONOTSEPARATEANYTHING *%magic%*&quot;</span><span class="p">,</span>
                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
                <span class="n">skip_blank_lines</span><span class="o">=</span><span class="n">skip_blank_lines</span><span class="p">,</span>
                <span class="n">skipinitialspace</span><span class="o">=</span><span class="n">skipinitialspace</span><span class="p">,</span>
                <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">convert_numeric</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">parse_number</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># In case we are re-reading, we must</span>
                <span class="c1"># ensure there is no value present now:</span>
                <span class="k">if</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="ScratchRealization.load_txt"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.load_txt">[docs]</a>    <span class="k">def</span> <span class="nf">load_txt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">,</span> <span class="n">convert_numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_reread</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a txt file with</span>
<span class="sd">        &lt;key&gt; &lt;value&gt;</span>
<span class="sd">        in each line.</span>

<span class="sd">        The txt file will be internalized in a dict and will be</span>
<span class="sd">        stored if the object is archived. Recommended file</span>
<span class="sd">        extension is &#39;txt&#39;.</span>

<span class="sd">        Common usage is internalization of parameters.txt which</span>
<span class="sd">        happens by default, but this can be used for all txt files.</span>

<span class="sd">        The parsed data is returned as a dict. At the ensemble level</span>
<span class="sd">        the same function returns a dataframe.</span>

<span class="sd">        There is no get&#39;er for the constructed data, access the</span>
<span class="sd">        class variable keyvaluedata directly, or rerun this function.</span>
<span class="sd">        (except for parameters.txt, for which there is a property</span>
<span class="sd">        called &#39;parameters&#39;)</span>

<span class="sd">        Values with spaces are not supported, this is similar</span>
<span class="sd">        to ERT&#39;s CSV_EXPORT1. Remainder string will be ignored silently.</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath: path local the realization to the txt file</span>
<span class="sd">            convert_numeric: defaults to True, will try to parse</span>
<span class="sd">                all values as integers, if not, then floats, and</span>
<span class="sd">                strings as the last resort.</span>
<span class="sd">            force_reread: Force reread from file system. If</span>
<span class="sd">                False, repeated calls to this function will</span>
<span class="sd">                returned cached results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary with the parsed values. Values will be returned as</span>
<span class="sd">                integers, floats or strings. If convert_numeric</span>
<span class="sd">                is False, all values are strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="n">localpath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;File not found: &quot;</span> <span class="o">+</span> <span class="n">fullpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reread</span><span class="p">:</span>
            <span class="c1"># Return cached version</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">filerow</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">:</span> <span class="n">localpath</span><span class="p">,</span>
                <span class="s2">&quot;FILETYPE&quot;</span><span class="p">:</span> <span class="n">localpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;FULLPATH&quot;</span><span class="p">:</span> <span class="n">fullpath</span><span class="p">,</span>
                <span class="s2">&quot;BASENAME&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">localpath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">keyvalues</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">fullpath</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span><span class="p">:</span>
            <span class="n">keyvalues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">convert_numeric</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keyvalues</span><span class="p">:</span>
                <span class="n">keyvalues</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_number</span><span class="p">(</span><span class="n">keyvalues</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">keyvalues</span>
        <span class="k">return</span> <span class="n">keyvalues</span></div>

<div class="viewcode-block" id="ScratchRealization.load_csv"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.load_csv">[docs]</a>    <span class="k">def</span> <span class="nf">load_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">,</span> <span class="n">convert_numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_reread</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a CSV file as a DataFrame</span>

<span class="sd">        Data will be stored as a DataFrame for later</span>
<span class="sd">        access or storage.</span>

<span class="sd">        Filename is relative to realization root.</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath: path local the realization to the txt file</span>
<span class="sd">            convert_numeric: defaults to True, will try to parse</span>
<span class="sd">                all values as integers, if not, then floats, and</span>
<span class="sd">                strings as the last resort.</span>
<span class="sd">            force_reread: Force reread from file system. If</span>
<span class="sd">                False, repeated calls to this function will</span>
<span class="sd">                returned cached results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe: The CSV file loaded. Empty dataframe</span>
<span class="sd">                if file is not present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="n">localpath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;File not found: &quot;</span> <span class="o">+</span> <span class="n">fullpath</span><span class="p">)</span>
        <span class="c1"># Look for cached version</span>
        <span class="k">if</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reread</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span>
        <span class="c1"># Check the file store, append if not there</span>
        <span class="k">if</span> <span class="n">localpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;LOCALPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">filerow</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">:</span> <span class="n">localpath</span><span class="p">,</span>
                <span class="s2">&quot;FILETYPE&quot;</span><span class="p">:</span> <span class="n">localpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;FULLPATH&quot;</span><span class="p">:</span> <span class="n">fullpath</span><span class="p">,</span>
                <span class="s2">&quot;BASENAME&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">localpath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">convert_numeric</span><span class="p">:</span>
                <span class="c1"># Trust that Pandas will determine sensible datatypes</span>
                <span class="c1"># faster than the convert_numeric() function</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span>
            <span class="n">dframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;REAL&quot;</span> <span class="ow">in</span> <span class="n">dframe</span><span class="p">:</span>
                <span class="n">dframe</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;REAL&quot;</span><span class="p">:</span> <span class="s2">&quot;REAL_ORIG&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;Loaded file </span><span class="si">%s</span><span class="s2"> already had the column REAL, &quot;</span>
                        <span class="s2">&quot;this was renamed to REAL_ORIG&quot;</span>
                    <span class="p">),</span>
                    <span class="n">fullpath</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span><span class="p">:</span>
            <span class="n">dframe</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># or empty dataframe?</span>

        <span class="c1"># Store parsed data:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">dframe</span>
        <span class="k">return</span> <span class="n">dframe</span></div>

<div class="viewcode-block" id="ScratchRealization.load_status"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.load_status">[docs]</a>    <span class="k">def</span> <span class="nf">load_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collects the contents of the STATUS files and return</span>
<span class="sd">        as a dataframe, with information from jobs.json added if</span>
<span class="sd">        available.</span>

<span class="sd">        Each row in the dataframe is a finished FORWARD_MODEL</span>
<span class="sd">        The STATUS files are parsed and information is extracted.</span>
<span class="sd">        Job duration is calculated, but jobs above 24 hours</span>
<span class="sd">        get incorrect durations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dataframe with information from the STATUS files.</span>
<span class="sd">            Each row represents one job in one of the realizations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">statusfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">statusfile</span><span class="p">):</span>
            <span class="c1"># This should not happen as long as __init__ requires STATUS</span>
            <span class="c1"># to be present.</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># will be empty</span>
        <span class="n">errorcolumns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;error&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">statusfile</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
            <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FORWARD_MODEL&quot;</span><span class="p">,</span> <span class="s2">&quot;colon&quot;</span><span class="p">,</span> <span class="s2">&quot;STARTTIME&quot;</span><span class="p">,</span> <span class="s2">&quot;dots&quot;</span><span class="p">,</span> <span class="s2">&quot;ENDTIME&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">errorcolumns</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
            <span class="n">on_bad_lines</span><span class="o">=</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">status</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">errorjobs</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="n">errorcolumns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Merge any error strings:</span>
        <span class="n">error_string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">status</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errorjobs</span><span class="p">,</span> <span class="n">errorcolumns</span><span class="p">]</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s2">&quot;errorstring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
        <span class="n">status</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errorjobs</span><span class="p">,</span> <span class="s2">&quot;errorstring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_string</span>
        <span class="n">status</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">errorcolumns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Delete potential unwanted row</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">status</span><span class="o">.</span><span class="n">FORWARD_MODEL</span> <span class="o">==</span> <span class="s2">&quot;LSF&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">colon</span> <span class="o">==</span> <span class="s2">&quot;JOBID:&quot;</span><span class="p">))]</span>

        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No parseable data in STATUS&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;STATUS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
            <span class="k">return</span> <span class="n">status</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;colon&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;dots&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Index the jobs, this makes it possible to match with jobs.json:</span>
        <span class="n">status</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;JOBINDEX&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Calculate duration. Only Python 3.6 has time.fromisoformat().</span>
        <span class="c1"># Warning: Unpandaic code..</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">jobrow</span> <span class="ow">in</span> <span class="n">status</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jobrow</span><span class="p">[</span><span class="s2">&quot;ENDTIME&quot;</span><span class="p">]:</span>  <span class="c1"># A job that is not finished.</span>
                <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">jobrow</span><span class="p">[</span><span class="s2">&quot;STARTTIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)))</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
                        <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">time</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">hms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minute</span><span class="o">=</span><span class="n">hms</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">second</span><span class="o">=</span><span class="n">hms</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="n">hms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">jobrow</span><span class="p">[</span><span class="s2">&quot;ENDTIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)))</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
                        <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">time</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">hms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minute</span><span class="o">=</span><span class="n">hms</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">second</span><span class="o">=</span><span class="n">hms</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="c1"># This works also when we have crossed 00:00:00.</span>
                    <span class="c1"># Jobs &gt; 24 h will be wrong.</span>
                    <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># We get where if STARTIME.split(&#39;:&#39;) does not contain</span>
                    <span class="c1"># integers only:</span>
                    <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="c1"># We get here if a clock time string is invalid, like missing seconds.</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got indexerror&quot;</span><span class="p">)</span>
                    <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s2">&quot;DURATION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">durations</span>

        <span class="c1"># Augment data from jobs.json if that file is available:</span>
        <span class="n">jsonfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;jobs.json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jsonfilename</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">jsonfilename</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonfilename</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
                    <span class="n">jobsinfo</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                <span class="n">jobsinfodf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">jobsinfo</span><span class="p">[</span><span class="s2">&quot;jobList&quot;</span><span class="p">])</span>
                <span class="n">jobsinfodf</span><span class="p">[</span><span class="s2">&quot;JOBINDEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobsinfodf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="c1"># Outer merge means that we will also have jobs from</span>
                <span class="c1"># jobs.json that has not started (failed or perhaps</span>
                <span class="c1"># the jobs are still running on the cluster)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">jobsinfodf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;JOBINDEX&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Parsing file </span><span class="si">%s</span><span class="s2"> failed, skipping&quot;</span><span class="p">,</span> <span class="n">jsonfilename</span><span class="p">)</span>
        <span class="n">status</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;JOBINDEX&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;STATUS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="ScratchRealization.apply"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback functionality</span>

<span class="sd">        A function handle can be supplied which will be executed on</span>
<span class="sd">        this realization. The function supplied *must* return</span>
<span class="sd">        a Pandas DataFrame. The function can accept an additional</span>
<span class="sd">        kwargs dictionary with extra information. Special keys</span>
<span class="sd">        in the kwargs data are &#39;realization&#39;, which will hold</span>
<span class="sd">        the current realization object. The key &#39;localpath&#39; is</span>
<span class="sd">        also reserved for the use inside this apply(), as it</span>
<span class="sd">        is used for the name of the internalized data.</span>

<span class="sd">        If the key &#39;dumptofile&#39; is a boolean and set to True,</span>
<span class="sd">        the resulting dataframe is also attempted written</span>
<span class="sd">        to disk using the supplied &#39;localpath&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (dict): which is supplied to the callbacked function,</span>
<span class="sd">                in which the key &#39;localpath&#39; also points the the name</span>
<span class="sd">                used for data internalization.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;realization&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Never supply realization= to apply()&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;realization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Allow for calling functions which cannot take any</span>
        <span class="c1"># arguments:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># lgtm [py/call/wrong-arguments]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">callback</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Returned value from applied &quot;</span> <span class="o">+</span> <span class="s2">&quot;function must be a dataframe&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Only internalize if &#39;localpath&#39; is given</span>
        <span class="k">if</span> <span class="s2">&quot;localpath&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;localpath&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">if</span> <span class="s2">&quot;dumptodisk&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dumptodisk&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;localpath&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;localpath must be supplied when&quot;</span> <span class="o">+</span> <span class="s2">&quot;dumptodisk is used&quot;</span>
                <span class="p">)</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runpath</span><span class="p">(),</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;localpath&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullpath</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing result of function call to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fullpath</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Direct access to the realization data structure</span>

<span class="sd">        Calls get_df(localpath).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes components in the internal datastore.</span>

<span class="sd">        Silently ignores data that is not found.</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath: string, fully qualified name of key</span>
<span class="sd">                (no shorthand as for get_df())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span>

<div class="viewcode-block" id="ScratchRealization.keys"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the keys of the internal data structure&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScratchRealization.get_df"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the internal datastore which contains dataframes or dicts</span>
<span class="sd">        or scalars.</span>

<span class="sd">        The localpath argument can be shortened, as it will be</span>
<span class="sd">        looked up using the function shortcut2path()</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath (str): the idenfier of the data requested</span>
<span class="sd">            merge (list or str): identifier/localpath of some data to be merged in,</span>
<span class="sd">                typically &#39;parameters.txt&#39;. Will only work when return type is a</span>
<span class="sd">                dataframe. If list is supplied, order can matter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe or dictionary.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError if data is not found.</span>
<span class="sd">            TypeError if data in localpath or merge is not of a mergeable type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">shortcut2path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">localpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Could not find </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">localpath</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">shortcut2path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">localpath</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">merge</span> <span class="o">=</span> <span class="p">[</span><span class="n">merge</span><span class="p">]</span>  <span class="c1"># can still be None</span>
        <span class="k">if</span> <span class="n">merge</span> <span class="ow">and</span> <span class="n">merge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Strange things can happen when we do merges since</span>
            <span class="c1"># this function happily returns references to the internal</span>
            <span class="c1"># dataframes in the realization object. So ensure</span>
            <span class="c1"># we copy dataframes if any merging is about to happen.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)):</span>
                <span class="c1"># Convert scalar data into something mergeable</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">localpath</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Don&#39;t know how to merge data &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;from </span><span class="si">{}</span><span class="s2"> of type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">for</span> <span class="n">mergekey</span> <span class="ow">in</span> <span class="n">merge</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mergekey</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mergedata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span><span class="n">mergekey</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mergedata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mergedata</span><span class="p">:</span>
                    <span class="c1"># Add a column to the data for each dictionary</span>
                    <span class="c1"># key:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergedata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mergedata</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)):</span>
                <span class="c1"># Scalar data, use the mergekey as column</span>
                <span class="n">data</span><span class="p">[</span><span class="n">mergekey</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergedata</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mergedata</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mergedata</span><span class="p">)</span>
                <span class="c1"># pd.MergeError will be raised here when this fails,</span>
                <span class="c1"># there must be common columns for this operation.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Don&#39;t know how to merge data &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;from </span><span class="si">{}</span><span class="s2"> of type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mergekey</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ScratchRealization.find_files"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.find_files">[docs]</a>    <span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metayaml</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Discover realization files. The files dataframe</span>
<span class="sd">        will be updated.</span>

<span class="sd">        Certain functionality requires up-front file discovery,</span>
<span class="sd">        e.g. ensemble archiving and ensemble arithmetic.</span>

<span class="sd">        CSV files for single use do not have to be discovered.</span>

<span class="sd">        Files containing double-dashes &#39;--&#39; indicate that the double</span>
<span class="sd">        dashes separate different component with meaning in the</span>
<span class="sd">        filename.  The components are extracted and put into</span>
<span class="sd">        additional columns &quot;COMP1&quot;, &quot;COMP2&quot;, etc..</span>
<span class="sd">        Filetype extension (after the last dot) will be removed</span>
<span class="sd">        from the last component.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths: str or list of str with filenames (will be globbed)</span>
<span class="sd">                that are relative to the realization directory.</span>
<span class="sd">            metadata: dict with metadata to assign for the discovered</span>
<span class="sd">                files. The keys will be columns, and its values will be</span>
<span class="sd">                assigned as column values for the discovered files.</span>
<span class="sd">                During rediscovery of files, old metadata will be removed.</span>
<span class="sd">            metayaml: Additional possibility of adding metadata from</span>
<span class="sd">                associated yaml files. Yaml files to be associated to</span>
<span class="sd">                a specific discovered file can have an optional dot in</span>
<span class="sd">                front, and must end in .yml, added to the discovered filename.</span>
<span class="sd">                The yaml file will be loaded as a dict, and have its keys</span>
<span class="sd">                flattened using the separator &#39;--&#39;. Flattened keys are</span>
<span class="sd">                then used as column headers in the returned dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A slice of the internalized dataframe corresponding</span>
<span class="sd">            to the discovered files (will be included even if it has</span>
<span class="sd">            been discovered earlier)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>
        <span class="n">returnedslice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">,</span> <span class="s2">&quot;FILETYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">,</span> <span class="s2">&quot;BASENAME&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">searchpath</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">globs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">f</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="n">searchpath</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">globs</span><span class="p">:</span>
                <span class="n">absmatch</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">absmatch</span><span class="p">)</span>
                <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                <span class="n">filetype</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">filerow</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;LOCALPATH&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">),</span>
                    <span class="s2">&quot;FILETYPE&quot;</span><span class="p">:</span> <span class="n">filetype</span><span class="p">,</span>
                    <span class="s2">&quot;FULLPATH&quot;</span><span class="p">:</span> <span class="n">absmatch</span><span class="p">,</span>
                    <span class="s2">&quot;BASENAME&quot;</span><span class="p">:</span> <span class="n">basename</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="c1"># Look for and split basename based on double-dash &#39;--&#39;</span>
                <span class="n">basename_noext</span> <span class="o">=</span> <span class="n">basename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">filetype</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;--&quot;</span> <span class="ow">in</span> <span class="n">basename_noext</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">compidx</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">basename_noext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)):</span>
                        <span class="n">filerow</span><span class="p">[</span><span class="s2">&quot;COMP&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">compidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">comp</span>

                <span class="k">if</span> <span class="n">metayaml</span><span class="p">:</span>
                    <span class="n">metadict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">yaml_candidates</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;.yml&quot;</span><span class="p">,</span>
                        <span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;.yml&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">,</span>
                        <span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                    <span class="c1"># We will only parse the first one found! You</span>
                    <span class="c1"># might be out of luck if you have multiple..</span>
                    <span class="k">for</span> <span class="n">cand</span> <span class="ow">in</span> <span class="n">yaml_candidates</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">cand</span><span class="p">)):</span>
                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">cand</span><span class="p">))</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
                                <span class="n">metadict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">full_load</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="c1"># Flatten metadict:</span>
                    <span class="n">metadict</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">metadict</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filerow</span><span class="p">:</span>
                            <span class="n">filerow</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;Cannot add key </span><span class="si">%s</span><span class="s2"> from yaml, key is in use. Skipping.&quot;</span><span class="p">,</span>
                                <span class="n">key</span><span class="p">,</span>
                            <span class="p">)</span>

                <span class="c1"># Delete this row if it already exists, determined by FULLPATH</span>
                <span class="k">if</span> <span class="n">absmatch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">absmatch</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">filerow</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">returnedslice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">returnedslice</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">filerow</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">returnedslice</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the data obtained from parameters.txt</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict with data from parameters.txt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;parameters.txt&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="ScratchRealization.get_eclfiles"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_eclfiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_eclfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_eclfiles is deprecated as ecl2df has been renamed to res2df.</span>
<span class="sd">        Use the function get_resdatafiles together with res2df instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAVE_ECL2DF</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ecl2df not installed. Skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">data_file_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FILETYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DATA&quot;</span><span class="p">]</span>
        <span class="n">data_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_file_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data_filename</span> <span class="o">=</span> <span class="n">data_file_row</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autodiscovery</span><span class="p">:</span>
            <span class="n">data_fileguess</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;eclipse/model&quot;</span><span class="p">,</span> <span class="s2">&quot;*.DATA&quot;</span><span class="p">)</span>
            <span class="n">data_filenamelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">data_fileguess</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data_filenamelist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No filename matches *DATA</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_filenamelist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;Multiple DATA files found, &quot;</span>
                        <span class="s2">&quot;consider turning off auto-discovery&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">data_filename</span> <span class="o">=</span> <span class="n">data_filenamelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There is no DATA file to be found.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No DATA file found!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ecl2df</span><span class="o">.</span><span class="n">EclFiles</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_resdatafiles"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_resdatafiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_resdatafiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an res2df.ResdataFiles object to connect to the res2df package</span>

<span class="sd">        If autodiscovery, it will search for a DATA file in</span>
<span class="sd">        the standard location eclipse/model/...DATA.</span>

<span class="sd">        If you have multiple DATA files, you must discover</span>
<span class="sd">        the one you need explicitly before calling this function, example:</span>

<span class="sd">            &gt;&gt;&gt; real = ScratchRealization(&quot;myrealpath&quot;)</span>
<span class="sd">            &gt;&gt;&gt; real.find_files(&quot;eclipse/model/MYMODELPREDICTION.DATA&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            res2df.ResdataFiles. None if nothing found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAVE_RES2DF</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;res2df not installed. Skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">data_file_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;FILETYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DATA&quot;</span><span class="p">]</span>
        <span class="n">data_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_file_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data_filename</span> <span class="o">=</span> <span class="n">data_file_row</span><span class="p">[</span><span class="s2">&quot;FULLPATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autodiscovery</span><span class="p">:</span>
            <span class="n">data_fileguess</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;eclipse/model&quot;</span><span class="p">,</span> <span class="s2">&quot;*.DATA&quot;</span><span class="p">)</span>
            <span class="n">data_filenamelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">data_fileguess</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data_filenamelist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No filename matches *DATA</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_filenamelist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;Multiple DATA files found, &quot;</span>
                        <span class="s2">&quot;consider turning off auto-discovery&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">data_filename</span> <span class="o">=</span> <span class="n">data_filenamelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There is no DATA file to be found.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No DATA file found!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">res2df</span><span class="o">.</span><span class="n">ResdataFiles</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_eclsum"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_eclsum">[docs]</a>    <span class="k">def</span> <span class="nf">get_eclsum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_restart</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch the Eclipse Summary file from the realization</span>
<span class="sd">        and return as a ResdataFile object</span>

<span class="sd">        Unless the UNSMRY file has been discovered, it will</span>
<span class="sd">        pick the file from the glob `eclipse/model/*UNSMRY`,</span>
<span class="sd">        as long as autodiscovery is not turned off when</span>
<span class="sd">        the realization object was initialized.</span>

<span class="sd">        If you have multiple UNSMRY files in eclipse/model</span>
<span class="sd">        turning off autodiscovery is strongly recommended.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cache: boolean indicating whether we should keep an</span>
<span class="sd">                object reference to the EclSum object. Set to</span>
<span class="sd">                false if you need to conserve memory.</span>
<span class="sd">            include_restart: boolean sent to resdata for whether restart</span>
<span class="sd">                files should be traversed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EclSum: object representing the summary file. None if</span>
<span class="sd">                nothing was found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="p">:</span>  <span class="c1"># Return cached object if available</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum_include_restart</span> <span class="o">==</span> <span class="n">include_restart</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span>

        <span class="n">unsmry_file_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">FILETYPE</span> <span class="o">==</span> <span class="s2">&quot;UNSMRY&quot;</span><span class="p">]</span>
        <span class="n">unsmry_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unsmry_file_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">unsmry_filename</span> <span class="o">=</span> <span class="n">unsmry_file_row</span><span class="o">.</span><span class="n">FULLPATH</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autodiscovery</span><span class="p">:</span>
            <span class="n">unsmry_fileguess</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;eclipse/model&quot;</span><span class="p">,</span> <span class="s2">&quot;*.UNSMRY&quot;</span><span class="p">)</span>
            <span class="n">unsmry_filenamelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">unsmry_fileguess</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">unsmry_filenamelist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No filename matches</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unsmry_filenamelist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Multiple UNSMRY files found, consider turning off auto-discovery&quot;</span>
                <span class="p">)</span>
            <span class="n">unsmry_filename</span> <span class="o">=</span> <span class="n">unsmry_filenamelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="n">unsmry_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There is no UNSMRY file to be found.</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">unsmry_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eclsum</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">(</span>
                <span class="n">unsmry_filename</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># This can happen if there is something wrong with the file</span>
            <span class="c1"># or if SMSPEC is missing.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to create summary instance from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unsmry_filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span> <span class="o">=</span> <span class="n">eclsum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum_include_restart</span> <span class="o">=</span> <span class="n">include_restart</span>

        <span class="k">return</span> <span class="n">eclsum</span></div>

<div class="viewcode-block" id="ScratchRealization.load_smry"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.load_smry">[docs]</a>    <span class="k">def</span> <span class="nf">load_smry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_index</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span>
        <span class="n">column_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_eclsum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">include_restart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce dataframe from Summary data from the realization</span>

<span class="sd">        When this function is called, the dataframe will be</span>
<span class="sd">        internalized.  Internalization of summary data in a</span>
<span class="sd">        realization object supports different time_index, but there is</span>
<span class="sd">        no handling of multiple sets of column_keys. The cached data</span>
<span class="sd">        will be called</span>

<span class="sd">          &#39;share/results/tables/unsmry--&lt;time_index&gt;.csv&#39;</span>

<span class="sd">        where &lt;time_index&gt; is among &#39;yearly&#39;, &#39;monthly&#39;, &#39;daily&#39;, &#39;first&#39;,</span>
<span class="sd">        &#39;last&#39; or &#39;raw&#39; (meaning the raw dates in the SMRY file), depending</span>
<span class="sd">        on the chosen time_index. If a custom time_index (list</span>
<span class="sd">        of datetime) was supplied, &lt;time_index&gt; will be called &#39;custom&#39;.</span>

<span class="sd">        Wraps resdata.summary.Summary.pandas_frame()</span>

<span class="sd">        See also get_smry()</span>

<span class="sd">        Args:</span>
<span class="sd">            time_index: string indicating a resampling frequency,</span>
<span class="sd">               &#39;yearly&#39;, &#39;monthly&#39;, &#39;daily&#39;, &#39;first&#39;, &#39;last&#39; or &#39;raw&#39;, the</span>
<span class="sd">               latter will return the simulated report steps (also default).</span>
<span class="sd">               If a list of DateTime is supplied, data will be resampled</span>
<span class="sd">               to these.</span>
<span class="sd">            column_keys: list of column key wildcards. None means everything.</span>
<span class="sd">            cache_eclsum: boolean for whether to keep the loaded EclSum</span>
<span class="sd">                object in memory after data has been loaded.</span>
<span class="sd">            start_date: str or date with first date to include.</span>
<span class="sd">                Dates prior to this date will be dropped, supplied</span>
<span class="sd">                start_date will always be included. Overridden if time_index</span>
<span class="sd">                is &#39;first&#39; or &#39;last&#39;.</span>
<span class="sd">            end_date: str or date with last date to be included.</span>
<span class="sd">                Dates past this date will be dropped, supplied</span>
<span class="sd">                end_date will always be included. Overridden if time_index</span>
<span class="sd">                is &#39;first&#39; or &#39;last&#39;.</span>
<span class="sd">            include_restart: boolean sent to resdata for whether restart</span>
<span class="sd">                files should be traversed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with summary keys as columns and dates as indices.</span>
<span class="sd">                Empty dataframe if no summary is available or column</span>
<span class="sd">                keys do not exist.</span>
<span class="sd">            DataFrame: with summary keys as columns and dates as indices.</span>
<span class="sd">                Empty dataframe if no summary is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache_eclsum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;cache_eclsum option to load_smry() is deprecated and &quot;</span>
                    <span class="s2">&quot;will be removed in fmu-ensemble v2.0.0&quot;</span>
                <span class="p">),</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache_eclsum</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="n">cache_eclsum</span><span class="p">):</span>
            <span class="c1"># Return empty, but do not store the empty dataframe in self.data</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">time_index_path</span> <span class="o">=</span> <span class="n">time_index</span>
        <span class="k">if</span> <span class="n">time_index</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
            <span class="n">time_index_arg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Note: This call will recache the smry object.</span>
            <span class="n">time_index_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smry_dates</span><span class="p">(</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">time_index</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">time_index_arg</span> <span class="o">=</span> <span class="n">time_index</span>
            <span class="n">time_index_path</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
        <span class="k">elif</span> <span class="n">time_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_index_path</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span>
            <span class="n">time_index_arg</span> <span class="o">=</span> <span class="n">time_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;time_index&#39; has to be a string, a list or None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">column_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_keys</span><span class="p">]</span>

        <span class="c1"># Do the actual work:</span>
        <span class="n">dframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">(</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache_eclsum</span><span class="p">,</span> <span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span>
        <span class="p">)</span><span class="o">.</span><span class="n">pandas_frame</span><span class="p">(</span><span class="n">time_index_arg</span><span class="p">,</span> <span class="n">column_keys</span><span class="p">)</span>
        <span class="n">dframe</span> <span class="o">=</span> <span class="n">dframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">dframe</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;DATE&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Cache the result:</span>
        <span class="n">localpath</span> <span class="o">=</span> <span class="s2">&quot;share/results/tables/unsmry--&quot;</span> <span class="o">+</span> <span class="n">time_index_path</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">dframe</span>

        <span class="c1"># Do this to ensure that we cut the rope to the EclSum object</span>
        <span class="c1"># Can be critical for garbage collection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_eclsum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">dframe</span></div>

<div class="viewcode-block" id="ScratchRealization.get_smry"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_smry">[docs]</a>    <span class="k">def</span> <span class="nf">get_smry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">column_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_eclsum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">include_restart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper for EclSum.pandas_frame</span>

<span class="sd">        This gives access to the underlying data on disk without</span>
<span class="sd">        touching internalized dataframes.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            time_index: string indicating a resampling frequency,</span>
<span class="sd">               &#39;yearly&#39;, &#39;monthly&#39;, &#39;daily&#39;, &#39;first&#39;, &#39;last&#39; or &#39;raw&#39;, the</span>
<span class="sd">               latter will return the simulated report steps (also default).</span>
<span class="sd">               If a list of DateTime is supplied, data will be resampled</span>
<span class="sd">               to these. If a date in ISO-8601 format is supplied, that is</span>
<span class="sd">               used as a single date.</span>
<span class="sd">            column_keys: list of column key wildcards. None means everything.</span>
<span class="sd">            cache_eclsum: boolean for whether to keep the loaded EclSum</span>
<span class="sd">                object in memory after data has been loaded.</span>
<span class="sd">            start_date: str or date with first date to include.</span>
<span class="sd">                Dates prior to this date will be dropped, supplied</span>
<span class="sd">                start_date will always be included. Overridden if time_index</span>
<span class="sd">                is &#39;first&#39; or &#39;last&#39;.</span>
<span class="sd">            end_date: str or date with last date to be included.</span>
<span class="sd">                Dates past this date will be dropped, supplied</span>
<span class="sd">                end_date will always be included. Overridden if time_index</span>
<span class="sd">                is &#39;first&#39; or &#39;last&#39;.</span>

<span class="sd">        Returns empty dataframe if there is no summary file, or if the</span>
<span class="sd">        column_keys are not existing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cache_eclsum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;cache_eclsum option to get_smry() is deprecated and &quot;</span>
                    <span class="s2">&quot;will be removed in fmu-ensemble v2.0.0&quot;</span>
                <span class="p">),</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache_eclsum</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">column_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_keys</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time_index</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
            <span class="n">time_index_arg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parseddate</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">isoparse</span><span class="p">(</span><span class="n">time_index</span><span class="p">)</span>
                <span class="n">time_index_arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">parseddate</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">time_index_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smry_dates</span><span class="p">(</span>
                    <span class="n">freq</span><span class="o">=</span><span class="n">time_index</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">time_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">time_index_arg</span> <span class="o">=</span> <span class="n">time_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;time_index&#39; has to be a string, a list or None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="n">cache_eclsum</span><span class="p">,</span> <span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">(</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache_eclsum</span><span class="p">,</span> <span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span>
                <span class="p">)</span><span class="o">.</span><span class="n">pandas_frame</span><span class="p">(</span><span class="n">time_index_arg</span><span class="p">,</span> <span class="n">column_keys</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># We get here if we have requested non-existing column keys</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_eclsum</span><span class="p">:</span>
                <span class="c1"># Ensure EclSum object can be garbage collected</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">dataframe</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScratchRealization.get_smry_meta"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_smry_meta">[docs]</a>    <span class="k">def</span> <span class="nf">get_smry_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide metadata for summary data vectors.</span>

<span class="sd">        A dictionary indexed by summary vector names is returned, and each</span>
<span class="sd">        value is another dictionary with potentially the metadata types:</span>
<span class="sd">        * unit (string)</span>
<span class="sd">        * is_total (bool)</span>
<span class="sd">        * is_rate (bool)</span>
<span class="sd">        * is_historical (bool)</span>
<span class="sd">        * get_num (int) (only provided if not None)</span>
<span class="sd">        * keyword (str)</span>
<span class="sd">        * wgname (str or None)</span>

<span class="sd">        Args:</span>
<span class="sd">            column_keys: List or str of column key wildcards</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_glob_smry_keys</span><span class="p">(</span><span class="n">column_keys</span><span class="p">)</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">eclsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">column_keys</span><span class="p">:</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">unit</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;is_total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">is_total</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;is_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">is_rate</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;is_historical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">smspec_node</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">is_historical</span><span class="p">()</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;keyword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">smspec_node</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">keyword</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;wgname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">smspec_node</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">wgname</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">eclsum</span><span class="o">.</span><span class="n">smspec_node</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">get_num</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">meta</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s2">&quot;get_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
        <span class="k">return</span> <span class="n">meta</span></div>

    <span class="k">def</span> <span class="nf">_glob_smry_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_keys</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility function for globbing column names</span>

<span class="sd">        Use this to expand &#39;F*&#39; to the list of Eclipse summary</span>
<span class="sd">        vectors matching.</span>

<span class="sd">        Args:</span>
<span class="sd">            column_keys: str or list of strings with patterns</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of strings. Empty list if no summary loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Calling _glob_smry_keys without loaded or found summary file &quot;</span>
                    <span class="s2">&quot;returns empty list&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">column_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_keys</span><span class="p">]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">column_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

<div class="viewcode-block" id="ScratchRealization.get_volumetric_rates"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_volumetric_rates">[docs]</a>    <span class="k">def</span> <span class="nf">get_volumetric_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute volumetric rates from cumulative summary vectors</span>

<span class="sd">        See :meth:`fmu.ensemble.util.compute_volumetric_rates`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">compute_volumetric_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_keys</span><span class="p">,</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_smryvalues"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_smryvalues">[docs]</a>    <span class="k">def</span> <span class="nf">get_smryvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props_wildcard</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch selected vectors from Eclipse Summary data.</span>

<span class="sd">        Args:</span>
<span class="sd">            props_wildcard : string or list of strings with vector</span>
<span class="sd">                wildcards</span>
<span class="sd">        Returns:</span>
<span class="sd">            a dataframe with values. Raw times from UNSMRY.</span>
<span class="sd">            Empty dataframe if no summary file data available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_smryvalues() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in fmu-ensemble v2.0.0. Process &quot;</span>
                <span class="s2">&quot;columns from get_smry() instead.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="p">:</span>  <span class="c1"># check if it is cached</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_glob_smry_keys</span><span class="p">(</span><span class="n">props_wildcard</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;numpy_vector&quot;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">prop</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="o">.</span><span class="n">numpy_vector</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">report_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">props</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># get_values() is deprecated in resdata</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">prop</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">report_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">props</span>
            <span class="p">}</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclsum</span><span class="o">.</span><span class="n">get_dates</span><span class="p">(</span><span class="n">report_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_smry_dates"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_smry_dates">[docs]</a>    <span class="k">def</span> <span class="nf">get_smry_dates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">include_restart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return list of datetimes available in the realization</span>

<span class="sd">        Args:</span>
<span class="sd">            freq: string denoting requested frequency for</span>
<span class="sd">                the returned list of datetime. &#39;report&#39; will</span>
<span class="sd">                yield the sorted union of all valid timesteps for</span>
<span class="sd">                all realizations. Other valid options are</span>
<span class="sd">                &#39;daily&#39;, &#39;weekly&#39;, &#39;monthly&#39; and &#39;yearly&#39;.</span>
<span class="sd">                &#39;first&#39; will give out the first date (minimum) and</span>
<span class="sd">                &#39;last&#39; will give out the last date (maximum),</span>
<span class="sd">                both as lists with one element.</span>
<span class="sd">            normalize: Whether to normalize backwards at the start</span>
<span class="sd">                and forwards at the end to ensure the raw</span>
<span class="sd">                date range is covered.</span>
<span class="sd">            start_date: str or date with first date to include</span>
<span class="sd">                Dates prior to this date will be dropped, supplied</span>
<span class="sd">                start_date will always be included. Overrides</span>
<span class="sd">                normalized dates. Overridden if freq is &#39;first&#39;</span>
<span class="sd">                or &#39;last&#39;.</span>
<span class="sd">            end_date: str or date with last date to be included.</span>
<span class="sd">                Dates past this date will be dropped, supplied</span>
<span class="sd">                end_date will always be included. Overrides</span>
<span class="sd">                normalized dates. Overridden if freq is &#39;first&#39;</span>
<span class="sd">                or &#39;last&#39;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list of datetimes. None if no summary data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eclsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eclsum</span><span class="p">(</span><span class="n">include_restart</span><span class="o">=</span><span class="n">include_restart</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eclsum</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">unionize_smry_dates</span><span class="p">(</span>
            <span class="p">[</span><span class="n">eclsum</span><span class="o">.</span><span class="n">dates</span><span class="p">],</span> <span class="n">freq</span><span class="p">,</span> <span class="n">normalize</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.contains"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.contains">[docs]</a>    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Boolean function for asking the realization for presence</span>
<span class="sd">        of certain data types and possibly data values.</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath: string pointing to the data for which the query</span>
<span class="sd">                applies. If no other arguments, only realizations containing</span>
<span class="sd">                this data key is kept.</span>
<span class="sd">            key: A certain key within a realization dictionary that is</span>
<span class="sd">                required to be present. If a value is also provided, this</span>
<span class="sd">                key must be equal to this value. If localpath is not</span>
<span class="sd">                a dictionary, this will raise a ValueError</span>
<span class="sd">            value: The value a certain key must equal. Floating point</span>
<span class="sd">                comparisons are not robust. Only relevant for dictionaries</span>
<span class="sd">            column: Name of a column in tabular data. If columncontains is</span>
<span class="sd">                not specified, this means that this column must be present</span>
<span class="sd">            columncontains:</span>
<span class="sd">                A value that the specific column must include.</span>

<span class="sd">        Returns:</span>
<span class="sd">            boolean: True if the data is present and fulfilling any</span>
<span class="sd">            criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">localpath</span> <span class="o">=</span> <span class="n">shortcut2path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">localpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">localpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;key&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;value&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;key&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t use key for tabular data&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t use value for tabular data&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;column&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;columncontains&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="c1"># Only asking for column presence</span>
                <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="s2">&quot;column&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;columncontains&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="c1"># If we are dealing with the DATE column,</span>
                <span class="c1"># convert everything to pandas datatime64 for comparisons,</span>
                <span class="c1"># otherwise we revert to simpler check.</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DATE&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;columncontains&quot;</span><span class="p">]))</span>
                        <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">][</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]])</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;columncontains&quot;</span><span class="p">]</span>
                    <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">][</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;key&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">][</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]])</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># non-string, then don&#39;t convert the internalized data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">localpath</span><span class="p">][</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong arguments to contains()&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.drop"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.drop">[docs]</a>    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete elements from internalized data.</span>

<span class="sd">        Shortcuts are allowed for localpath. If the data pointed to is</span>
<span class="sd">        a DataFrame, you can delete columns, or rows containing certain</span>
<span class="sd">        elements</span>

<span class="sd">        If the data pointed to is a dictionary, keys can be deleted.</span>

<span class="sd">        Args:</span>
<span class="sd">            localpath: string, path to internalized data. If no other options</span>
<span class="sd">                are supplied, that dataset is deleted in its entirety</span>
<span class="sd">            column: string with a column name to drop. Only for dataframes</span>
<span class="sd">            columns: list of strings with column names to delete</span>
<span class="sd">            rowcontains: rows where one column contains this string will be</span>
<span class="sd">                dropped. The comparison is on strings only, and all cells in</span>
<span class="sd">                the dataframe is converted to strings for the comparison.</span>
<span class="sd">                Thus it might work on dates, but be careful with numbers.</span>
<span class="sd">            key: string with a keyname in a dictionary. Will not work for</span>
<span class="sd">                dataframes</span>
<span class="sd">            keys: list of strings of keys to delete from a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">shortcut2path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">localpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">localpath</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fullpath</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># This will remove the entire dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;column&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;columns&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;rowcontains&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="c1"># Construct boolean series for those rows that have a match</span>
                <span class="n">boolseries</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rowcontains&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
                    <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fullpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">boolseries</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;keys&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">]:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;key&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represent the realization. Show only the last part of the path&quot;&quot;&quot;</span>
        <span class="n">pathsummary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indexstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexstr</span> <span class="o">=</span> <span class="s2">&quot;Error&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Realization, index=</span><span class="si">{}</span><span class="s2">, path=...</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexstr</span><span class="p">,</span> <span class="n">pathsummary</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Substract another realization from this&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RealizationCombination</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add another realization from this&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RealizationCombination</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale this realization by a scalar value&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RealizationCombination</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add another realization from this&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RealizationCombination</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Substract another realization from this&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RealizationCombination</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale this realization by a scalar value&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RealizationCombination</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="ScratchRealization.get_init"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_init">[docs]</a>    <span class="k">def</span> <span class="nf">get_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: init file of the realization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_init() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">init_file_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">FILETYPE</span> <span class="o">==</span> <span class="s2">&quot;INIT&quot;</span><span class="p">]</span>
        <span class="n">init_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_file_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">init_filename</span> <span class="o">=</span> <span class="n">init_file_row</span><span class="o">.</span><span class="n">FULLPATH</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init_fileguess</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;eclipse/model&quot;</span><span class="p">,</span> <span class="s2">&quot;*.INIT&quot;</span><span class="p">)</span>
            <span class="n">init_filenamelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">init_fileguess</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">init_filenamelist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No filename matches</span>
            <span class="n">init_filename</span> <span class="o">=</span> <span class="n">init_filenamelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">init_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclinit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eclinit</span> <span class="o">=</span> <span class="n">ResdataFile</span><span class="p">(</span><span class="n">init_filename</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">FileMode</span><span class="o">.</span><span class="n">CLOSE_STREAM</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclinit</span></div>

<div class="viewcode-block" id="ScratchRealization.get_unrst"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_unrst">[docs]</a>    <span class="k">def</span> <span class="nf">get_unrst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: restart file of the realization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_unrst() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">unrst_file_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">FILETYPE</span> <span class="o">==</span> <span class="s2">&quot;UNRST&quot;</span><span class="p">]</span>
        <span class="n">unrst_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unrst_file_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">unrst_filename</span> <span class="o">=</span> <span class="n">unrst_file_row</span><span class="o">.</span><span class="n">FULLPATH</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unrst_fileguess</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;eclipse/model&quot;</span><span class="p">,</span> <span class="s2">&quot;*.UNRST&quot;</span><span class="p">)</span>
            <span class="n">unrst_filenamelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">unrst_fileguess</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">unrst_filenamelist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No filename matches</span>
            <span class="n">unrst_filename</span> <span class="o">=</span> <span class="n">unrst_filenamelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">unrst_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclunrst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eclunrst</span> <span class="o">=</span> <span class="n">ResdataFile</span><span class="p">(</span><span class="n">unrst_filename</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">FileMode</span><span class="o">.</span><span class="n">CLOSE_STREAM</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclunrst</span></div>

<div class="viewcode-block" id="ScratchRealization.get_grid_index"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_grid_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active_only</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the grid index in a pandas dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid_index() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span><span class="o">.</span><span class="n">export_index</span><span class="p">(</span><span class="n">active_only</span><span class="o">=</span><span class="n">active_only</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No GRID file in realization </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_grid_corners"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_grid_corners">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_corners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dataframe with the the x, y, z for the</span>
<span class="sd">        8 grid corners of corner point cells&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid_corners() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">():</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span><span class="o">.</span><span class="n">export_corners</span><span class="p">(</span><span class="n">grid_index</span><span class="p">)</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;x1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x6&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y6&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z6&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x7&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y7&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z7&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;z8&quot;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No GRID file in realization </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_grid_centre"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_grid_centre">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the grid centre of corner-point-cells, x, y and z</span>
<span class="sd">        in distinct columns&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid_centre() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">():</span>
            <span class="n">grid_cell_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span><span class="o">.</span><span class="n">export_position</span><span class="p">(</span><span class="n">grid_index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">grid_cell_centre</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cell_x&quot;</span><span class="p">,</span> <span class="s2">&quot;cell_y&quot;</span><span class="p">,</span> <span class="s2">&quot;cell_z&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No GRID file in realization </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_grid"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_grid">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: grid file of the realization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">grid_file_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">FILETYPE</span> <span class="o">==</span> <span class="s2">&quot;EGRID&quot;</span><span class="p">]</span>
        <span class="n">grid_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_file_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">grid_filename</span> <span class="o">=</span> <span class="n">grid_file_row</span><span class="o">.</span><span class="n">FULLPATH</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_fileguess</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_origpath</span><span class="p">,</span> <span class="s2">&quot;eclipse/model&quot;</span><span class="p">,</span> <span class="s2">&quot;*.EGRID&quot;</span><span class="p">)</span>
            <span class="n">grid_filenamelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">grid_fileguess</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grid_filenamelist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No filename matches</span>
            <span class="n">grid_filename</span> <span class="o">=</span> <span class="n">grid_filenamelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">grid_filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclgrid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eclgrid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">(</span><span class="n">grid_filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eclgrid</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">global_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: Number of cells in the realization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span><span class="o">.</span><span class="n">get_global_size</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">actnum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: EclKw of ints showing which cells are active,</span>
<span class="sd">            Active cells are given value 1, while</span>
<span class="sd">            inactive cells have value 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actnum</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_init</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_actnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_init</span><span class="p">()[</span><span class="s2">&quot;PORV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">create_actnum</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actnum</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">report_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: List of DateTime.DateTime for which values are reported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_grid() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unrst</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unrst</span><span class="p">()</span><span class="o">.</span><span class="n">report_dates</span>

<div class="viewcode-block" id="ScratchRealization.get_global_init_keyword"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_global_init_keyword">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_init_keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param prop: A name of a keyword in the realization&#39;s init file.</span>
<span class="sd">        :returns: The EclKw of given name. Length is global_size.</span>
<span class="sd">            non-active cells are given value 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_global_init_keyword() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_init</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_init</span><span class="p">()[</span><span class="n">prop</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actnum</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScratchRealization.get_global_unrst_keyword"><a class="viewcode-back" href="../../../fmu.ensemble.html#fmu.ensemble.realization.ScratchRealization.get_global_unrst_keyword">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_unrst_keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">report</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param prop: A name of a keyword in the realization&#39;s restart file.</span>
<span class="sd">        :returns: The EclKw of given name. Length is global_size.</span>
<span class="sd">            non-active cells are given value 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;realization.get_global_unrst_keyword() is deprecated and &quot;</span>
                <span class="s2">&quot;will be removed in later versions.&quot;</span>
            <span class="p">),</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unrst</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unrst</span><span class="p">()[</span><span class="n">prop</span><span class="p">][</span><span class="n">report</span><span class="p">]</span><span class="o">.</span><span class="n">scatter_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actnum</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Equinor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #ff1243;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #474747;
    }
    .wy-side-nav-search > div.version {
      color: white;
￼   }
  </style>


</body>
</html>